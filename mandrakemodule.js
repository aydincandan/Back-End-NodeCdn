let modulFUNCmdk=d=>{let t=(e,o)=>{if(null!==e&&"object"==typeof e)for(var n in e)"number"!=typeof e[n]&&"function"!=typeof e[n]&&(console.log("\t",typeof e[n],{key:n},"Buffer"===e[n]?.type,Array.isArray(e[n]?.data),Array.isArray(e[n])),Array.isArray(e[n])&&(e[n].data=o(e[n].data)),"object"==typeof e[n])&&t(e[n],o)};let a=(e,o,n)=>{var t=[];let l=[e];for(var r=new Set;0<l.length;){var a=l.pop();if("object"==typeof a&&null!==a){if(!r.has(a))for(var i in r.add(a),a)i===o?(t.push(a[i]),a[i]=n(a[i])):l.push(a[i])}else Array.isArray(a)&&a.forEach(e=>l.push(e))}return t};return{zamanDamgasi:()=>{var e=new Date;return`${e.getFullYear()}.${String(e.getMonth()+1).padStart(2,"0")}.${String(e.getDate()).padStart(2,"0")}-${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}:`+String(e.getMilliseconds()).padStart(3,"0")},newFormData:async(e,o,n)=>{var t=n||!1;t&&console.log("*** BAŞLIYOR-1 ***",e);let l=new FormData;if(e&&o){if(t&&console.log("boş mu",l),e)for(var[r,a]of Object.entries(e))l.append(r,a);if(t&&console.log("dolu mu",l),o){t&&console.log("*** BAŞLIYOR-2 ***",o);for(var i of o){var s=await(async e=>{let o=!0;if(e.buffer){o=!1;var n=new Blob([e.buffer],{type:e.mimetype});l.append("attachments",n,e.originalname),console.log("formData.append('attachments', blob, ",e.originalname)}else if(e.redisKey){o=!1,console.log("========== ŞİMDİ BU DURUMU TEST ET ========="),process.exit(1);try{var t=await myredis.getAsync(e.redisKey);e.buffer=new Blob([t],{type:e.mimetype}),e.buffer=Buffer.from(t),l.append("attachments",e.buffer,e.originalname),console.log("redisten okunan dosya->",e.buffer)}catch(e){console.log("redisKey TTL ile zaman asimina ugramis olabiir.",e)}finally{console.log("- - - - - - - - - - - - - -")}}return o})(i);t&&console.log("sonuc file_buffer_VEYA_file_redisKey",s),1==s&&(s=d.readFileSync(i.path),t&&console.log("fileBuffer",s),s=new Blob([s],{type:i.mimetype}),l.append("attachments",s,i.originalname),t)&&console.log("|========== EKLENDI ===========",i.originalname)}t&&console.log("nasıl dolu mu",l),t&&console.log("|========== "+o.length+" =========== tüm attacler eklendi")}else t||console.log("========== Ve cikis ===========",o.length),t||console.log("newFormData",{formData:l}),t||console.log("========== Ve cikis ===========",o.length),t&&console.log("newFormData *** BİTTİ *** return formData")}return l},response_final:(e,o,n,t,l)=>{var r={};if(r.response_final={status:n,kimden3:e.headers["x-nerden"],req_originalUrl:e.originalUrl,final_data:t},500!=n)try{a(r,"buffer",e=>e.slice(0,5))}catch(e){}return console.log("_^_^_^_^_^_^_^_^_^_^_^_^"),l&&console.log("response_final->",{verbose:l},n,r),console.log("status:",n),console.log(""),console.log(""),console.log("Browser'a dönüş yapildi Via mandrakemodule.js"),console.log(""),console.log(""),console.log("=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|=|"),o.status(n).json(r)},isBrowser:()=>"undefined"!=typeof window&&void 0!==window.document,isNode:()=>"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,isElectron:()=>"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.electron,findAndModifyBuffer:t,GetValiumOptimized:function(e,o){var n=[];let t=[e];for(var l=new Set;0<t.length;){var r=t.pop();if("object"==typeof r&&null!==r){if(!l.has(r))for(var a in l.add(r),r)(a===o?n:t).push(r[a])}else Array.isArray(r)&&r.forEach(e=>t.push(e))}return n},findOneModify:a,Mandrake:(l,e)=>{null==l&&(l=void 0);let o=!1,{prod_server_origin:t,prod_client_origin:n}=(null==e?e={prod_server_origin:"",prod_client_origin:"",mndrk_Actions:[]}:o=!0,e),r=e=>new URL(e).origin;var a=window.location.origin,i=window.location.protocol,s=window.location.hostname,d=window.location.port;let c=!1,f=!1,u=(a==r(i+"localhost:"+d)?c=!0:f=!0,!1),m=!1,g=(a==n?m=!0:u=!0,document.getElementById(l));if(g){var p=g.action,y=g.baseURI,p={userManuelACTION:p,baseURI:y,userManuelACTIONvar:!(p===y),PROD:m,TEST:u,REMO:f,LOCA:c,docClientOrigin:a,docClientProtocol:i,docClientHostname:s,docClientPort:d,htmlFormElement:g,setup_mevcut:o,setup:e},y=(console.log({RETURNS:p}),e.mndrk_Actions);console.log("************x************",{actionsArray:y});if(0<y.length){Array.isArray(y)&&y.forEach((e,o,n)=>{1==c&&1==u?n[o]=e:1==f&&1==m?n[o]=e.replace(r(e),t):n[o]="action bilinmiyor"}),console.log("***********x*************",{actionsArray:y}),document.getElementById("selectedRedActionDiv")||((a=document.createElement("div")).id="selectedRedActionDiv",a.style="color:red",g.after(a));let o=document.getElementById("selectedRedActionDiv");o&&(o.innerHTML="This FORM[#"+l+"] action: <b style='color:blue'>"+y[0]+"</b> actionsArray[0]",g.action=y[0]);i=document.getElementById("actions");if(console.log({actionsSelector:i}),null==i){let t=document.createElement("select");t.id="actions",t.name="actions",o.before(t),Array.isArray(y)&&y.forEach((e,o)=>{var n=document.createElement("option");n.id="URL"+(o+1),n.value=e,n.innerText=`LOCAL: ${c} ve TEST: ${u} | `+e,t.add(n)}),t.addEventListener("change",e=>{e=e.target.value;o.innerHTML="This FORM[#"+l+"] action: <b style='color:blue'>"+e+"</b> selectedValue",g.action=e})}s=document.getElementById(l+"_feedback"),d=s||document.createElement("textarea");s||(d.class="feedback",d.name=l+"_feedback",d.id=l+"_feedback",d.rows="25",d.style="font-size: 15px; width:100%; margin:0px;",o.after(d))}return g.addEventListener("submit",async e=>{e.preventDefault();let n=document.getElementById(l+"_feedback");var e=XanaduForclient(g),o=(n.innerHTML="Xanadu BEKLENİYOR... "+e.url,console.log("mandrake -> XanaduForclient : ",{xfc:e}),document.querySelector('input[name="agent1"]:checked')?.value);Xanadu(o,e.url,e.FetchSendOptions,e.AxiosSendData,e.AxiosSendOptions).then(e=>{console.log({resultXanadu:e}),n.innerHTML=JSON.stringify(e,null,4).replace(/<br\s*\/?>/gi,"\n").replace(/\\n /gi,"\n\t")}).catch(e=>{console.log({errXanadu:e});var o=JSON.stringify(e,null,4).replace(/<br\s*\/?>/gi,"\n").replace(/\\n /gi,"\n\t");n.innerHTML="{}"==o?String(e):o})}),p}console.error(l+" -> htmlFormElementID tanimli değil!")}}},globalSCOPEmdk="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:this;((e,o)=>{"function"==typeof define&&define.amd?(console.log("--------------- mandrakemodule AMD"),define(["fs"],o)):"object"==typeof module&&"object"==typeof module.exports?(console.log("--------------- mandrakemodule CJS"),module.exports=o(require("fs"))):(console.log("--------------- mandrakemodule BRW-1"),void 0===e.fs?(console.error("HATA: global.fs tanimli değil!"),e.mandrakemodule=modulFUNCmdk(e.fs)):e.mandrakemodule=o(e.fs))})(globalSCOPEmdk,modulFUNCmdk);